(this["webpackJsonpmap-game-client"]=this["webpackJsonpmap-game-client"]||[]).push([[0],{120:function(e,t,n){},158:function(e,t,n){},159:function(e,t,n){"use strict";n.r(t);var a=n(2),c=n(0),r=n.n(c),o=n(11),s=n.n(o),i=(n(120),n(103)),l=n(19),j=n(7),u=n(13),d=n(22),b=n(217),O=n(198),m=n(199),h=n(213),g=n(201),x=n(214),f=n(191),p=n(218),v=n(194),y=n(196),S=["#52BE80","#DAF7A6","#FFC300","#FF5733","#2C3E50","#5D6D7E"],C=Object(f.a)((function(){return Object(p.a)({root:{flexGrow:1,minHeight:"100vh",position:"relative",backgroundColor:"#D1F2EB"},menuButton:{marginRight:20},title:{flexGrow:1},header:{backgroundColor:S[0]},footer:{backgroundColor:S[0],fontSize:10,margin:"auto",color:"white",position:"absolute",bottom:0,width:"100%",height:"2.5rem",padding:0,marginTop:20},footerContent:{margin:"auto"},container:{paddingTop:20,paddingBottom:100},buttonGreen:{background:S[0],color:"white"},cardContainer:{margin:"auto",width:400,backgroundColor:"#F9EBEA",textAlign:"center",padding:20,marginBottom:20,marginTop:20},icon:{width:"auto",height:60}})})),N=function(e){var t=e.children,n=C();return Object(a.jsxs)("div",{className:n.root,children:[Object(a.jsx)(v.a,{position:"static",children:Object(a.jsx)(y.a,{className:n.header,children:Object(a.jsx)("h3",{children:"JeoJuessr"})})}),Object(a.jsx)("div",{className:n.container,children:t}),Object(a.jsx)(y.a,{className:n.footer,children:Object(a.jsx)("div",{className:n.footerContent,children:"footer stuff"})})]})},k=n.p+"static/media/icon.f293e650.png",w=function(e){var t=e.socket,n=Object(d.a)(e,["socket"]),r=C(),o=Object(c.useState)(""),s=Object(j.a)(o,2),i=s[0],l=s[1],u=Object(c.useState)(""),f=Object(j.a)(u,2),p=f[0],v=f[1],y=Object(c.useState)(!1),S=Object(j.a)(y,2),w=S[0],R=S[1],P=Object(c.useState)(""),T=Object(j.a)(P,2),I=T[0],D=T[1],A=Object(c.useState)(""),G=Object(j.a)(A,2),L=G[0],F=G[1];Object(c.useEffect)((function(){}),[t]);return Object(a.jsxs)(N,{children:[Object(a.jsx)(b.a,{open:w,autoHideDuration:5e3,onClose:function(){return R(!1)},children:Object(a.jsx)(x.a,{elevation:6,variant:"filled",severity:L,onClose:function(){return R(!1)},children:I})}),Object(a.jsxs)("div",{style:{textAlign:"center"},children:[Object(a.jsx)("img",{className:r.icon,src:k,alt:"joejuessrlogo"}),Object(a.jsx)(O.a,{className:r.cardContainer,children:Object(a.jsxs)(m.a,{children:[Object(a.jsx)("p",{children:"Still in development"}),Object(a.jsx)("p",{children:"Please write in 'Room Name' anything, then tell your friends to write the same thing to play together. Or you can play by yourself."}),Object(a.jsx)("p",{children:"This is in development so there are probably hella bugs. ToDo: add leaderboard. Make finding new positions better. Using open street maps and Mapillary."}),Object(a.jsx)("p",{children:"It is possible to reconnect to a game by writing the exact same name."}),Object(a.jsx)(h.a,{id:"player-text-field",placeholder:"Name",value:p,onChange:function(e){return v(e.target.value)}}),Object(a.jsx)("br",{}),Object(a.jsx)("br",{}),Object(a.jsx)(h.a,{id:"room-text-field",placeholder:"Room Name",value:i,onChange:function(e){return l(e.target.value)}}),Object(a.jsx)("br",{}),Object(a.jsx)("br",{}),Object(a.jsx)(g.a,{className:r.buttonGreen,variant:"contained",onClick:function(){if(""===i||""===p)return R(!0),F("error"),void D("Please fill in your name and room name");t.emit("roomConnection",{roomName:i,playerName:p}),t.on("roomConnectionCallback",(function(e){D(e.message),F(e.status),R(!0),"success"===e.status&&n.history.push(ie)}))},children:"Connect"})]})})]})]})},R=n(96),P=n.n(R),T=n(97),I=n(207),D=n(58),A=function(e){return e.sort((function(e,t){return e.score<t.score?1:e.score>t.score?-1:0}))},G=function(e,t){e.emit("connectedToAnyRoom"),e.on("connectedToAnyRoomCallback",(function(e){e.playerNotConnectedToGame&&t.history.push(oe)}))},L=(n(91),n(18)),F=n.n(L),B=n(98),U=(n(154),n(99)),E=n(202),M=n(203),W=n(204),z=n(205),J=n(206),Y=n(219),H=function(e){var t=e.socket,n=e.setImageUrls,o=e.imageLoaded,s=e.guessSentCallback,i=e.isLeader,l=e.distance,u=e.roundPosition,d=e.setGuessSent,b=e.guessSent,O=e.players,m=e.playerName,h=e.roundOver,x=e.setRoundOver,f=Object(c.useState)({lat:51.505,lng:-.09}),p=Object(j.a)(f,2),v=p[0],y=p[1],S=Object(c.useState)({lat:51.505,lng:-.09}),N=Object(j.a)(S,2),k=(N[0],N[1]),w=C(),R=function(e){return F.a.icon({iconUrl:e?B.a:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png",shadowUrl:U.a,iconSize:[25,41],iconAnchor:[10,41]})},P=function(){return u?Object(a.jsx)(E.a,{icon:R(!0),position:u}):null},T=function(){return u?Object(a.jsx)(M.a,{positions:[[u.lat,u.lng],[v.lat,v.lng]]}):null},I=function(e){return Math.round(100*e)/100},A=function(){return Object(W.a)({click:function(e){console.log("map clicked",e.latlng);var t=I(Math.max(e.latlng.lat,v.lat)),n=I(Math.min(e.latlng.lat,v.lat)),a=I(Math.max(e.latlng.lng,v.lng)),c=I(Math.min(e.latlng.lng,v.lng));console.log("{ max: ".concat(t,", min: ").concat(n,", lngIntervals:[\n         { min: ").concat(c," , max:").concat(a," }\n        ] },")),k(v),h||y({lat:e.latlng.lat,lng:e.latlng.lng})}}),Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(E.a,{icon:R(!1),position:v}),h&&Object(a.jsx)(P,{}),h&&Object(a.jsx)(T,{}),O.map((function(e){return e.markerPosition&&e.name!==m?Object(a.jsx)(E.a,{icon:F.a.icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-grey.png",iconSize:[25,41],iconAnchor:[10,41]}),position:e.markerPosition,children:Object(a.jsx)(z.a,{children:e.name})},e.name):null}))]})},G=function(){t.emit("handleStartNextRound",{}),n([]),d(!1),x(!1)},L=function(){return b&&u||h?i?Object(a.jsx)("div",{style:{textAlign:"center"},children:Object(a.jsx)(g.a,{onClick:G,variant:"contained",className:w.buttonGreen,children:"Start next round"})}):Object(a.jsx)("div",{style:{textAlign:"center"},children:Object(a.jsx)(D.a,{children:"Waiting for leader to start next round"})}):null};return Object(a.jsxs)("div",{style:{padding:20},children:[o&&!u&&Object(a.jsxs)("div",{style:{textAlign:"center"},children:[Object(a.jsx)(D.a,{children:"You have to send your guess"}),Object(a.jsx)(g.a,{onClick:function(){s(),d(!0);var e=function(e){var t=0;for(e<180?t=360:e>180&&(t=-360);Math.abs(e)>180;)e+=t;return e}(+v.lng);t.emit("handleSendGuess",{position:{lat:v.lat,lng:e}})},variant:"contained",className:w.greenButton,children:"Send"})]}),Object(a.jsxs)(J.a,{center:[51.505,-.09],zoom:2,style:{height:400,width:"70%",margin:"auto",marginBottom:15},bounds:F.a.latLngBounds(F.a.latLng(90,180),F.a.latLng(-90,-180)),children:[Object(a.jsx)(A,{}),Object(a.jsx)(Y.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}.png"})]}),u&&Object(a.jsx)(r.a.Fragment,{children:-1!==l?Object(a.jsxs)(D.a,{style:{textAlign:"center",paddingBottom:20},children:["You were ",l.toLocaleString()," KM from the correct position."]}):Object(a.jsx)(D.a,{style:{textAlign:"center",paddingBottom:20},children:"You did not guess this round."})}),b&&!u&&Object(a.jsx)("div",{style:{textAlign:"center",paddingBottom:20},children:Object(a.jsx)(D.a,{children:"Waiting for other players to finish."})}),Object(a.jsx)(L,{})]})},_=n(100),K=(n(156),function(e){var t=e.imageUrls,n=e.currentIndex,o=e.setCurrentIndex,s=e.guessSent,i=(e.imageData,Object(c.useState)(void 0)),l=Object(j.a)(i,2),u=l[0],d=l[1],b=r.a.createRef(),O=function(e){u&&u.setPanorama(t[e]).then((function(){}),(function(e){console.log("error",e)}))};Object(c.useEffect)((function(){if(t.length>0)if(u)O(0);else{var e=new _.Viewer({container:b.current,panorama:t[0],navbar:!1,loadingTxt:""});d(e)}}),[null===t||void 0===t?void 0:t.length]);var m=t.length>0?"block":"none";return Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsxs)("div",{className:"pano-container",style:{display:m},children:[Object(a.jsxs)(D.a,{style:{textAlign:"center"},children:[n+1," / ",t.length," "]}),Object(a.jsx)("button",{className:"pano-btn",id:"pano-prev-btn",onClick:function(){var e=-1;0===n?(o(t.length-1),e=t.length-1):(o(n-1),e=n-1),O(e)},children:Object(a.jsx)("i",{className:"arrow arrow-left"})}),Object(a.jsx)("button",{className:"pano-btn arrow-right",id:"pano-next-btn",onClick:function(){var e=-1;n===t.length-1?(e=0,o(0)):(e=n+1,o(n+1)),O(e)},children:Object(a.jsx)("i",{className:"arrow"})}),Object(a.jsx)("div",{style:{height:400,width:"100%"},id:"viewer",ref:b})]}),Object(a.jsx)("div",{style:{display:t.length>0?"none":"block"},children:s?Object(a.jsx)(D.a,{style:{textAlign:"center"},children:"Waiting for leader to start round."}):Object(a.jsx)("div",{style:{textAlign:"center"},children:Object(a.jsx)(I.a,{})})})]})}),V=n(105),q=n(200),Q=n(208),X=n(209),Z=n(210),$=n(211),ee=function(e){var t=e.players,n=e.roomName,c=C();return Object(a.jsxs)(V.a,{className:c.cardContainer,children:[Object(a.jsxs)(D.a,{variant:"h6",children:["Players in room ",n]}),Object(a.jsxs)(q.a,{dense:!1,style:{width:400,margin:"auto"},children:[Object(a.jsxs)(Q.a,{children:[Object(a.jsx)(X.a,{inset:!0,children:"Name"}),Object(a.jsx)(X.a,{children:"Score"})]}),t.map((function(e,t){var n=t%2===0?"#ffeeee":"inherit";return Object(a.jsx)(r.a.Fragment,{children:Object(a.jsxs)(Q.a,{style:{backgroundColor:n},children:[e.isLeader&&Object(a.jsx)(Z.a,{children:Object(a.jsx)($.a,{})}),Object(a.jsx)(X.a,{inset:!e.isLeader,primary:e.name}),Object(a.jsx)(X.a,{primary:(+e.score).toLocaleString()})]})},"".concat(e.name,"-").concat(t))}))]})]})},te=function(e){var t=e.socket,n=Object(d.a)(e,["socket"]),o=Object(c.useState)(0),s=Object(j.a)(o,2),i=s[0],l=s[1],u=Object(c.useState)(""),b=Object(j.a)(u,2),O=b[0],m=b[1],h=Object(c.useState)([]),x=Object(j.a)(h,2),f=x[0],p=x[1],v=Object(c.useState)(!1),y=Object(j.a)(v,2),S=y[0],w=y[1],R=Object(c.useState)(!1),P=Object(j.a)(R,2),L=P[0],F=P[1],B=Object(c.useState)([]),U=Object(j.a)(B,2),E=U[0],M=U[1],W=Object(c.useState)(!1),z=Object(j.a)(W,2),J=z[0],Y=z[1],_=Object(c.useState)(-1),V=Object(j.a)(_,2),q=V[0],Q=V[1],X=Object(c.useState)(void 0),Z=Object(j.a)(X,2),$=Z[0],te=Z[1],ne=Object(c.useState)(60),ae=Object(j.a)(ne,2),ce=ae[0],re=ae[1],oe=Object(c.useState)("countDownTimer"),se=Object(j.a)(oe,2),ie=se[0],le=se[1],je=Object(c.useState)(60),ue=Object(j.a)(je,2),de=ue[0],be=ue[1],Oe=Object(c.useState)(0),me=Object(j.a)(Oe,2),he=me[0],ge=me[1],xe=Object(c.useState)(0),fe=Object(j.a)(xe,2),pe=fe[0],ve=fe[1],ye=Object(c.useState)(!1),Se=Object(j.a)(ye,2),Ce=Se[0],Ne=Se[1],ke=Object(c.useState)(!1),we=Object(j.a)(ke,2),Re=we[0],Pe=we[1],Te=Object(c.useState)(""),Ie=Object(j.a)(Te,2),De=Ie[0],Ae=Ie[1],Ge=Object(c.useState)(""),Le=Object(j.a)(Ge,2),Fe=Le[0],Be=Le[1],Ue=Object(c.useState)(!1),Ee=Object(j.a)(Ue,2),Me=Ee[0],We=Ee[1],ze=Object(c.useState)(!1),Je=Object(j.a)(ze,2),Ye=Je[0],He=Je[1],_e=Object(c.useState)([]),Ke=Object(j.a)(_e,2),Ve=Ke[0],qe=Ke[1],Qe=C(),Xe=Object(c.useCallback)((function(){le("countDownTimer"===ie?"countDownTimer2":"countDownTimer"),re(de),F(!0)}),[ie,de]);Object(c.useEffect)((function(){t&&(G(t,n),function(e){var t=e.socket,n=e.setGameOver,a=e.setRoomName,c=e.setCurrentRound,r=e.setNumberOfRounds,o=e.setTimePerRound,s=e.setTimerSeconds,i=e.setPlayers,l=e.setCurrentIndex,j=e.setImageUrls,u=e.setImgUrl,d=e.setImageLoaded,b=e.setDistance,O=e.setGuessSent,m=e.startCountDownTimer,h=e.setRoundOver,g=e.setRoundPosition,x=e.setImageData;t.on("handleSendImages",(function(e){n(!1);var t=e.gameData,f=e.players;f=A(f);var p=e.timePerRound,v=e.currentRound,y=e.numberOfRounds,S=e.roomName;a(S),c(v),r(y),o(p),s(p),i(f);var C=[];if(x(t.features),t.features.length>0){for(var N=0;N<t.features.length;N++){var k=t.features[N].properties.key,w="https://images.mapillary.com/".concat(k,"/thumb-2048.jpg");C.push(w)}l(0),j(C),u(C[0]),d(!0),g(void 0),b(-1),O(!1),m(),h(!1)}}))}({socket:t,setGameOver:Ne,setRoomName:Ae,setCurrentRound:ge,setNumberOfRounds:ve,setTimePerRound:be,setTimerSeconds:re,setPlayers:M,setCurrentIndex:l,setImageUrls:p,setImgUrl:m,setImageLoaded:w,setDistance:Q,setGuessSent:Pe,startCountDownTimer:Xe,setRoundOver:We,setRoundPosition:te,setImageData:qe}),function(e){var t=e.socket,n=e.setPlayerName,a=e.setPlayers,c=e.setRoundPosition,r=e.setDistance,o=e.setIsLeader,s=e.setCountdownStarted,i=e.setRoundOver;t.on("handleRoundOver",(function(e){var t=e.isGameLeader,l=e.correctPosition,j=e.distance,u=e.players,d=e.playerName;n(d),a(u),c(l),r(j),o(t),s(!1),i(!0)}))}({socket:t,setPlayerName:Be,setPlayers:M,setRoundPosition:te,setDistance:Q,setIsLeader:Y,setCountdownStarted:F,setRoundOver:We}),t.on("handleGameOver",(function(e){var t=e.players;t=A(t),M(t),Ne(!0)})),t.on("gameStarted",(function(){Ne(!1),Q(-1),He(!1),We(!1),te(void 0)})))}),[t,Xe]);var Ze=function(){He(!0),t.emit("handleStartGame",{timePerRound:de,numberOfRounds:pe})},$e=function(){return Ye?Object(a.jsx)("div",{style:{textAlign:"center"},children:Object(a.jsx)(I.a,{})}):Object(a.jsx)(g.a,{variant:"contained",onClick:Ze,className:Qe.buttonGreen,children:"Play again"})};return Object(a.jsxs)(N,{children:[Ce?Object(a.jsxs)("div",{style:{textAlign:"center"},children:[Object(a.jsx)("h3",{children:"Game Over"}),J?Object(a.jsx)($e,{}):Object(a.jsx)(D.a,{children:"Waiting for leader to start again"})]}):Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsxs)("div",{id:"info-container",style:{padding:15,textAlign:"center",position:"relevant"},children:[Object(a.jsx)("div",{id:"count-down-container",style:{margin:"auto",position:"absolute",top:90,left:10},children:Object(a.jsx)(T.CountdownCircleTimer,{isPlaying:L,size:70,duration:ce,colors:[["#004777",.33],["#F7B801",.33],["#A30000",.33]],children:function(e){return e.remainingTime}},ie)}),Object(a.jsx)("img",{className:Qe.icon,src:k,alt:"jjicon"}),Object(a.jsxs)(D.a,{children:["Round ",he," of ",pe]})]}),Object(a.jsx)(K,{imgUrl:O,imageUrls:f,currentIndex:i,setCurrentIndex:l,setImgUrl:m,guessSent:Re,imageData:Ve}),Object(a.jsx)(H,{socket:t,setImageUrls:p,imageLoaded:S,guessSentCallback:function(){w(!1)},isLeader:J,distance:q,roundPosition:$,setGuessSent:Pe,guessSent:Re,players:E,playerName:Fe,roundOver:Me,setRoundOver:We})]}),E.length>0&&Object(a.jsx)(ee,{players:E,roomName:De})]})},ne=n(212),ae=n(215),ce=function(e){var t=e.socket,n=Object(d.a)(e,["socket"]),o=Object(c.useState)(""),s=Object(j.a)(o,2),i=s[0],l=s[1],u=Object(c.useState)([]),b=Object(j.a)(u,2),O=b[0],m=b[1],x=Object(c.useState)(!1),f=Object(j.a)(x,2),p=f[0],v=f[1],y=Object(c.useState)(5),S=Object(j.a)(y,2),k=S[0],w=S[1],R=Object(c.useState)(60),P=Object(j.a)(R,2),T=P[0],I=P[1],A=Object(c.useState)(!0),L=Object(j.a)(A,2),F=L[0],B=L[1],U=Object(c.useState)(!1),E=Object(j.a)(U,2),M=E[0],W=(E[1],C());Object(c.useEffect)((function(){t&&(G(t,n),t.emit("connectedToWaitingRoom"),t.once("connectedToWaitingRoomCallback",(function(e){var t=e.roomName,n=e.players,a=e.isLeader;l(t),v(a),m(n)})),t.on("updatePlayers",(function(e){var t=e.players;t&&m(t)})),t.on("gameStarted",(function(){n.history.push(se)})))}),[t,n.history]);return Object(a.jsx)(N,{children:Object(a.jsxs)(V.a,{elevation:1,className:W.cardContainer,children:[Object(a.jsx)("h3",{children:"Waiting room"}),Object(a.jsxs)("h5",{children:["Room ",i]}),Object(a.jsxs)(D.a,{children:["To play with your friends, tell them to write '",i,"' in the room inputbox and press connect!"]}),Object(a.jsx)(D.a,{children:"Players in room"}),Object(a.jsx)(q.a,{style:{width:200,margin:"auto"},children:O.map((function(e,t){return Object(a.jsx)(r.a.Fragment,{children:Object(a.jsxs)(Q.a,{children:[Object(a.jsx)(X.a,{children:e.name}),e.isLeader?Object(a.jsx)(Z.a,{children:Object(a.jsx)($.a,{})}):Object(a.jsx)(X.a,{})]})},"".concat(e.name,"-").concat(t))}))}),p?Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsx)("br",{}),Object(a.jsx)("br",{}),Object(a.jsx)(D.a,{children:"Number of Rounds"}),Object(a.jsx)(h.a,{id:"numberofrounds-text-field",type:"number",placeholder:"Number of rounds",value:k,onChange:function(e){return w(e.target.value)}}),Object(a.jsx)("br",{}),Object(a.jsx)("br",{}),Object(a.jsx)(D.a,{children:"Seconds per round"}),Object(a.jsx)(h.a,{id:"timeperround-text-field",type:"number",placeholder:"seconds per round",value:T,onChange:function(e){return I(e.target.value)}}),Object(a.jsx)("br",{}),Object(a.jsx)("br",{}),Object(a.jsx)(ne.a,{control:Object(a.jsx)(ae.a,{checked:F,onChange:function(){B(!F)}}),label:"Use only panoramas?"}),Object(a.jsx)("br",{}),Object(a.jsx)("br",{}),Object(a.jsx)(g.a,{onClick:function(){isNaN(+T)||isNaN(+k)||t.emit("handleStartGame",{timePerRound:T,numberOfRounds:k,onlyPano:F,onlyEuropeUsa:M})},variant:"contained",className:W.buttonGreen,children:"Start Game"})]}):Object(a.jsx)(D.a,{children:"Waiting for leader to start the game."})]})})},re={ENDPOINT:window.location.hostname}.ENDPOINT,oe="/",se="/game",ie="/waitingroom",le=function(){var e=Object(c.useState)(void 0),t=Object(j.a)(e,2),n=t[0],r=t[1];return Object(c.useEffect)((function(){var e=P.a.connect(re);r(e),e.on("connectedToRoomCallBack",(function(e){}))}),[]),Object(a.jsxs)(u.c,{children:[Object(a.jsx)(u.a,{exact:!0,path:oe,render:function(e){return Object(a.jsx)(w,Object(l.a)(Object(l.a)({},e),{},{socket:n}))}}),Object(a.jsx)(u.a,{path:se,render:function(e){return Object(a.jsx)(te,Object(l.a)(Object(l.a)({},e),{},{socket:n}))}}),Object(a.jsx)(u.a,{path:ie,render:function(e){return Object(a.jsx)(ce,Object(l.a)(Object(l.a)({},e),{},{socket:n}))}})]})};n(158);var je=function(){return Object(a.jsx)(i.a,{basename:"/jeojuessr",children:Object(a.jsx)(le,{})})},ue=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,220)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,o=t.getTTFB;n(e),a(e),c(e),r(e),o(e)}))};s.a.render(Object(a.jsx)(je,{}),document.getElementById("root")),ue()},91:function(e,t,n){}},[[159,1,2]]]);
//# sourceMappingURL=main.8a16c076.chunk.js.map